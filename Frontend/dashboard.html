<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="css/styles.css" rel="stylesheet" />
  </head>

  <body class="d-flex justify-content-center align-items-center vh-100">
    <div class="container py-4">
      <div class="text-end mb-3">
        <button id="logoutBtn" class="btn btn-danger">Logout</button>
      </div>

      <h2 class="mb-4 text-center">Dashboard</h2>

      <div id="admin-section" style="display: none">
        <h4>Admin Panel: Manage Homes</h4>

        <div id="admin-homes">
          <h5>Homes</h5>
          <ul class="list-group" id="admin-homes-list"></ul>
        </div>

        <div id="loadingSpinner" class="spinner" style="display: none">
          Loading...
        </div>

        <div id="add-home-form" class="mt-4">
          <h5>Add New Home</h5>
          <form>
            <div class="mb-2">
              <label class="form-label">Home Name</label>
              <input
                type="text"
                id="newHomeName"
                class="form-control"
                required
              />
            </div>
            <button type="submit" class="btn btn-outline-success">
              Add Home
            </button>
          </form>
        </div>
        <div id="edit-home-form" class="mt-4" style="display: none">
          <h5>Edit Home Name</h5>
          <form>
            <input type="hidden" id="editHomeId" />
            <div class="mb-2">
              <label class="form-label">New Home Name</label>
              <input
                type="text"
                id="editHomeName"
                class="form-control"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="cancelEditHome()"
            >
              Cancel
            </button>
          </form>
        </div>
      </div>

      <div id="user-section" style="display: none">
        <h4 id="user-home-title"></h4>
        <div id="home-details">
          <p><strong id="selected-home-name">Loading...</strong></p>
        </div>
        <div id="devices-section" class="mt-4" style="display: none">
          <h5>Devices in your home</h5>
          <ul class="list-group" id="devices-list"></ul>
        </div>

        <div id="rollerShutter-list" class="mt-4">
          <h5>Roller Shutters</h5>
          <ul class="list-group" id="rollerShutter-list-items"></ul>
        </div>

        <div id="rollerShutter-controls" class="mt-4" style="display: none">
          <h6>Adjust Selected Shutter</h6>
          <div id="rollerShutterStatus" class="mb-2">
            Select a shutter from the list
          </div>
          <div>
            <button
              class="btn btn-sm btn-primary"
              onclick="adjustRollerShutterOpening(true)"
            >
              Increase +10%
            </button>
            <button
              class="btn btn-sm btn-danger"
              onclick="adjustRollerShutterOpening(false)"
            >
              Decrease -10%
            </button>
          </div>
        </div>

        <div id="shutter-general-controls" class="mt-4">
          <h6>General Shutter Control</h6>
          <div class="mt-2">
            <button class="btn btn-primary" onclick="openAllShutters()">
              Open All Shutters
            </button>
            <button class="btn btn-danger" onclick="closeAllShutters()">
              Close All Shutters
            </button>
          </div>
        </div>

        <div id="light-sensors-section" class="mt-4" style="display: none">
          <h5>Light Sensors</h5>
          <ul class="list-group" id="light-sensors-list"></ul>

          <div class="mt-3">
            <h6>Add New Sensor</h6>
            <form>
              <div class="row g-2">
                <div class="col">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="newSensorName"
                    placeholder="Name"
                    required
                  />
                </div>
                <div class="col">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="newSensorOpening"
                    placeholder="Opening (%)"
                    min="0"
                    max="100"
                    required
                  />
                </div>
                <div class="col">
                  <input type="hidden" id="newSensorHomeId" />
                </div>
                <div class="col-auto">
                  <button class="btn btn-sm btn-outline-primary" type="submit">
                    + Add Sensor
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div id="edit-light-sensor" class="mt-4" style="display: none">
          <h5>Edit Light Sensor</h5>
          <form>
            <input type="hidden" id="sensorEditId" />
            <div class="mb-2">
              <label class="form-label">New Name</label>
              <input type="text" id="editSensorName" class="form-control" />
            </div>
            <div class="mb-2">
              <label class="form-label">Opening (%)</label>
              <input
                type="number"
                id="editSensorOpening"
                class="form-control"
                min="0"
                max="100"
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Home ID (Readonly or hidden)</label>
              <input
                type="text"
                id="editSensorHome"
                class="form-control"
                readonly
              />
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="cancelEditSensor()"
            >
              Cancel
            </button>
          </form>
        </div>
      </div>
      <div id="automations-section" class="mt-5" style="display: none">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h4 id="automations-section-title">Automations</h4>
          <button
            class="btn btn-sm btn-outline-success"
            onclick="showAutomationForm()"
          >
            + Add Automation
          </button>
        </div>

        <input type="hidden" id="automation-home-id-hidden" />

        <ul class="list-group" id="automations-list"></ul>

        <div id="automation-form" class="mt-4" style="display: none">
          <h5 id="form-title">Create Automation</h5>
          <form>
            <div class="mb-2">
              <label class="form-label">Name</label>
              <input
                type="text"
                id="automationName"
                class="form-control"
                required
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Select Device (Shutter)</label>
              <select
                id="automationDeviceId"
                class="form-select"
                required
              ></select>
            </div>

            <div class="mb-2">
              <label class="form-label">Trigger</label>
              <select
                id="triggerType"
                class="form-select"
                onchange="toggleTriggerOptions()"
                required
              >
                <option value="luminosity">Luminosity</option>
                <option value="time">Time</option>
              </select>

              <div id="triggerLuminositySection" class="mt-2">
                <label for="triggerLuminosity" class="form-label"
                  >Luminosity Condition</label
                >
                <select id="triggerLuminosity" class="form-select">
                  <option value="0">Below 10%</option>
                  <option value="20">Below 20%</option>
                  <option value="40">Below 40%</option>
                  <option value="60">Above 60%</option>
                  <option value="80">Above 80%</option>
                  <option value="100">Above 90%</option>
                </select>
              </div>

              <div id="triggerTimeSection" class="mt-2" style="display: none">
                <label for="triggerTime" class="form-label"
                  >Time Condition</label
                >
                <input type="time" id="triggerTime" class="form-control" />
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label">Action</label>
              <select id="action" class="form-select" required>
                <option value="open">Open</option>
                <option value="close">Close</option>
              </select>
              <div class="mt-2">
                <label for="actionPercentage" class="form-label"
                  >To Percentage</label
                >
                <select id="actionPercentage" class="form-select" required>
                  <option value="0">0% (Closed)</option>
                  <option value="25">25%</option>
                  <option value="50">50%</option>
                  <option value="75">75%</option>
                  <option value="100">100% (Open)</option>
                </select>
              </div>
            </div>

            <div class="d-flex gap-2 mt-3">
              <button type="submit" class="btn btn-primary">Save</button>
              <button
                type="button"
                class="btn btn-danger"
                onclick="cancelAutomation()"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/user.js"></script>
    <script src="js/shutters.js"></script>
    <script src="js/sensors.js"></script>
    <script src="js/automations.js"></script>
    <script src="js/dashboard.js"></script>
  </body>
</html>
